!function(){if(window)if(window.location.ancestorOrigins){var t=e=>{const t=new URL(e).hostname.split(".");return t.slice(t[t.length-1].length<3&&t[t.length-2].length<3?-3:-2).join(".")};for(let e=0;e<window.location.ancestorOrigins.length;++e)if(window.location.ancestorOrigins[e]!=window.location.origin&&t(window.location.ancestorOrigins[e])!=t(window.location.origin))return}else if(window.top!=window||window.parent!=window)return;const n=(""+Math.random()).substring(2,20),r=window.BroadcastChannel?new BroadcastChannel(n):window;let s={};const a=["camera-16","camera-17"];let o=new Promise((t,e)=>{chrome.storage.local.get().then(e=>{console.log("loaded settings",JSON.stringify(e,null," ")),s=e.settings||{};const o=()=>{var e;s.camera?.selected&&a.indexOf(s.camera?.selected)<0&&(e={name:s.camera.selected,options:s.camera.items?.[s.camera.selected]},r.postMessage({nonce:n,dir:"from",method:"setprocess",type:"videocapture",body:e})),s.screen?.selected&&(e={name:s.screen.selected,options:s.screen.items?.[s.screen.selected]},r.postMessage({nonce:n,dir:"from",method:"setprocess",type:"screencapture",body:e})),s.camera?.selected&&0<=a.indexOf(s.camera?.selected)&&(e={name:s.camera.selected,options:s.camera.items?.[s.camera.selected]},r.postMessage({nonce:n,dir:"from",method:"setprocess",type:"mediastream",body:e}))};i(s).then(()=>{o(),t(!0)}),chrome.storage.onChanged.addListener((e,t)=>{if("local"==t)for(var n in e)"settings"==n&&(n=e[n],console.log("changed settings",n.newValue,n.oldValue),i(s=n.newValue).then(()=>{o()}))})}).catch(e=>{t(!0)})});const c={};function i(e){const t=Object.values(e).map(e=>Object.values(e.items||{}).filter(e=>0<e.file?.length).map(e=>e.file||[])).flat(2).filter(e=>e.bloburl);return Promise.all(t.map(o=>{const r=o.bloburl;return delete o.bloburl,c[r]?(o.dataurl=c[r],Promise.resolve()):new Promise((n,e)=>{fetch(r).then(e=>e.blob()).then(e=>{const t=new FileReader;t.onloadend=()=>{o.dataurl=c[r]=t.result,n()},t.onerror=()=>{n()},t.readAsDataURL(e)}).catch(e=>{n()})})}))}var e="chrome-extension://"+chrome.runtime.id+"/res";r.addEventListener("message",async function(t){if(!(t.source&&t.source!==window||t.data.nonce!=n||"to"!=t.data.dir)&&t.data.request){let e="";try{e=await async function(t){if(await o,t.request?.function){let e={};return"videocapture"==t.request.function&&s?.camera?.selected&&a.indexOf(s?.camera?.selected)<0?e[t.request.function]={name:s.camera.selected,options:s.camera.items?.[s.camera.selected]}:"screencapture"==t.request.function&&s?.screen?.selected?e[t.request.function]={name:s.screen.selected,options:s.screen.items?.[s.screen.selected]}:"mediastream"==t.request.function&&s?.camera?.selected&&0<=a.indexOf(s?.camera?.selected)&&(e[t.request.function]={name:s.camera.selected,options:s.camera.items?.[s.camera.selected]}),e}}(t.data)}catch(e){}t={id:t.data.id,dir:"from",nonce:t.data.nonce,response:{resolve:e}};r.postMessage(t,"*")}}),document.querySelector("html").setAttribute("rtchelper-nonce",n),document.querySelector("html").setAttribute("rtchelper-respath",e),window._rtchelper=!0}();
