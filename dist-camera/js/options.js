!function(){function c(e,t){return(t||document).querySelector(e)}function r(e,t){return[].slice.call((t||document).querySelectorAll(e))}window.addEventListener("load",()=>{chrome.storage.local.get().then(e=>{l=e.settings||{},e=l,Object.entries(e).forEach(([,i])=>{Object.entries(i.items||{}).forEach(([e,t])=>{0<t.file?.length&&(t.file.forEach(e=>{e.bloburl&&(console.log("revoke",e.bloburl),URL.revokeObjectURL(e.bloburl))}),t.file=t.file.filter(e=>!e.bloburl),t.file.length||(console.log("delete value.file",t),delete t.file,Object.keys(t).length||delete i.items[e]))})}),e=l,Object.entries(e).forEach(([e,t])=>{const s=c("div."+e);t.selected&&c(`div.items > div[name="${t.selected}"]`,s)?.setAttribute("selected",""),t.controls&&Object.entries(t.controls).forEach(([e,t])=>{const i=c(`div.controls > *[name="${e}"]`,s);"INPUT"==i.nodeName&&!0===t?i.checked=!0:"SELECT"==i.nodeName?i.value=t:console.warn("invalid node name",i.nodeName)}),t.items&&Object.entries(t.items).forEach(([e,t])=>{var i=c(`div.items > div[name="${e}"]`,s);t.select&&c("select",i)&&(c("select",i).value=t.select);for(let e=0;e<5;++e)t["select"+(e+1)]&&(r("select",i)[e].value=t["select"+(e+1)]);t.input&&c("input[type='text']",i)&&(c("input[type='text']",i).value=t.input);for(let e=0;e<5;++e)t["input"+(e+1)]&&(r("input[type='text']",i)[e].value=t["input"+(e+1)]);if(t.file){const l=c("input[type='file']",i);if(l){0<l._files?.length&&l._files.forEach(e=>{e.bloburl&&URL.revokeObjectURL(e.bloburl)}),l._files=t.file||[];const o=new DataTransfer;l._files.forEach(async e=>{const t=await fetch(e.dataurl||e.bloburl);var i=await t.blob(),i=new File([i],e.name,{type:e.type,lastModified:e.lastModified});o.items.add(i),o.items.length==l._files.length&&(l.files=o.files)})}}})})}),c("a.reset").onclick=e=>{e.preventDefault(),e.stopImmediatePropagation();e=o();0<Object.keys(e).length&&(r("div.items > div[selected]").forEach(e=>e.removeAttribute("selected")),r("div.controls > input[type='checkbox']").forEach(e=>{e.checked=!1}),r("div.controls > select").forEach(e=>{e.selectedIndex=0}),r("div.items > div > input[type='file']").forEach(e=>{e.value="",0<e._files?.length&&e._files.forEach(e=>{e.bloburl&&URL.revokeObjectURL(e.bloburl)}),e._files=[]}),r("div.items > div > input[type='text']").forEach(e=>{e.value=""}),r("div.items > div > select").forEach(e=>{e.selectedIndex=0}),s(!0))},c("button.save").onclick=e=>{const t=o();console.log("save settings",JSON.stringify(t,null," ")),chrome.storage.local.set({settings:t}).then(()=>{l=t,s(!1)}).catch(e=>{console.error("failed to save",e)})},r("div.controls > input[type='checkbox']").forEach(e=>{e.onclick=e=>{s(!0)}}),r("div.controls > select").forEach(e=>{e.onchange=e=>{s(!0)}}),r("div.items > div").forEach((e,t)=>{e.style.backgroundImage="url("+i+"/"+e.getAttribute("name")+".jpg)",e.onclick=e=>{s(!0);const t=e.currentTarget;t.hasAttribute("selected")?t.removeAttribute("selected"):(c("div.items > div[selected]",t.parentNode)?.removeAttribute("selected"),t.setAttribute("selected",""))}}),r("div.items > div > select, div.items > div > input").forEach(e=>{e.onclick=e=>e.stopImmediatePropagation()}),r("div.items > div > input[type='text']").forEach(e=>{e.onkeyup=e=>{s(!0)}}),r("div.items > div > select, div.items > div > input").forEach(l=>{l.onchange=e=>{s(!0),"INPUT"==l.nodeName&&"file"==l.getAttribute("type")&&(l._files=[],[...l.files].forEach((e,t)=>{if(e.size<=1048576){const i=new FileReader;i.onload=()=>{l._files[t]={name:e.name,lastModified:e.lastModified,size:e.size,type:e.type,dataurl:i.result}},i.readAsDataURL(e)}else console.log("using bloburl for large file"),l._files[t]={name:e.name,lastModified:e.lastModified,size:e.size,type:e.type,bloburl:URL.createObjectURL(e)}}))}})});const i="chrome-extension://"+chrome.runtime.id+"/res";let l={};function o(){const s={};return["camera","screen"].forEach(e=>{var t=c("div."+e);const i={},l=c("div.items > div[selected]",t);l&&(i.selected=l.getAttribute("name"));var o=[].concat(r("div.controls > select",t).filter(e=>0<e.selectedIndex).map(e=>[e.getAttribute("name"),e.value]),r("div.controls > input[type='checkbox']",t).filter(e=>e.checked).map(e=>[e.getAttribute("name"),!0])),o=(0<o.length&&(i.controls=Object.fromEntries(o)),r("div.items > div",t).map(e=>{var t=c("select",e),i=c("input[type='text']",e),l=c("input[type='file']",e);const o=r("select",e),s=r("input[type='text']",e),n={select:o.length<=1&&0<t?.selectedIndex?t.value:void 0,input:s.length<=1&&i?.value||void 0,file:0<l?._files?.length&&l?._files||void 0};return 1<o.length&&o.forEach((e,t)=>{e.value&&(n["select"+(t+1)]=e.value)}),1<s.length&&s.forEach((e,t)=>{e.value&&(n["input"+(t+1)]=e.value)}),[e.getAttribute("name"),JSON.parse(JSON.stringify(n))]}).filter(([,e])=>0<Object.keys(e).length));0<o.length&&(i.items=Object.fromEntries(o)),0<Object.keys(i).length&&(s[e]=i)}),s}function s(e){const t=c("div.content");e&&!t.hasAttribute("dirty")?t.setAttribute("dirty",""):!e&&t.hasAttribute("dirty")&&t.removeAttribute("dirty")}}();
