(window._rtchelper||document.querySelector("html").hasAttribute("rtchelper")?function(){}:function(){var t={};const c=["videocapture","screencapture","devicelist","mediarecord","mediadisplay","mediastream","usermedia","mediacodec","mediaconnect","medianetwork","mediastats","datachannel","websocket","webrequest","pagesecurity","cpuperformance","usercontrols"],e=["Capture","Screen","Devices","Record","Videos","Media","Session","Connect","Network","Stats","Data","Socket","Request","Security","CPU","Controls"];if(name2tab=t=>{console.assert(c.length===e.length);t=e.indexOf(t);return 0<=t?c[t]:""},document.currentScript){const k=document.currentScript.getAttribute("src");var o=k.indexOf("?");if(0<=o){const z=k.substring(o);Object.assign(t,Object.fromEntries(z.substring(1).split("&").filter(t=>!!t).map(t=>{var e=t.indexOf("=");return 0<=e?[decodeURIComponent(t.substring(0,e)),decodeURIComponent(t.substring(e+1))]:[t,null]})))}}const s=t=>(""+Math.random()).substring(2,t||8),p=s(20),m=new BroadcastChannel(p),n={},f={},u={};var r,o=t=>Object.fromEntries(t.split("|").map(t=>t.trim()).filter(t=>t).map(t=>{var e=t.indexOf(":");return e<0?[t,void 0]:[t.substring(0,e),t.substring(e+1)]}));t.settings&&(r=o(t.settings),Object.assign(u,r)),t.required&&(r=o(t.required),Object.assign(f,r),Object.assign(u,r));{const L=JSON.parse(localStorage["rtchelp:settings"]||"{}");["mode","theme","fontsize","strict","savestats"].forEach(t=>{void 0!==L[t]&&void 0===f[t]&&(u[t]=L[t])}),u.theme||(u.theme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),u.fontsize||(u.fontsize="small"),u.strict&&setTimeout(()=>{var t={dir:"from",method:"setstrict",nonce:p,value:u.strict};m.postMessage(t,"*")}),u.savestats&&setTimeout(()=>{var t={dir:"from",method:"setsavestats",nonce:p,value:u.savestats};m.postMessage(t,"*")})}function i(l){return new Promise((t,e)=>{if(0<=c.indexOf(l.function)){var o=localStorage.rtchelp;if("object"==typeof(o=void 0===o?localStorage.rtchelp=!0:JSON.parse(o)))for(var r in o)r!==l.function&&delete o[r];u.strict?setTimeout(()=>{t({resolve:o})}):t({resolve:o})}else{if("set_usercontrols"==l.function){var s=[...l.args][0];let t=JSON.parse(localStorage.rtchelp);if("object"==typeof t&&t.usercontrols&&t.usercontrols.variables){const a=t.usercontrols.variables.find(t=>t.varname==s.varname);a?(i=h(t),a.value=s.value,n=h(t),localStorage.rtchelp=JSON.stringify(t),g(i,n),b&&b.setUserControls(s)):console.warn("undefined variable",s.varname)}}else"on_usercontrols"==l.function?(i=[...l.args][0],i.value?d[i.varname]=!0:delete d[i.varname]):"set_mediastats"==l.function&&([...n]=[...l.args],b&&b.setMediastats(...n));t()}var n,i})}const d={};function h(t){return Object.fromEntries((t.usercontrols?.variables||[]).map(t=>[t.varname,t.value]))}function g(e,o){Object.keys(d).forEach(t=>{e[t]!==o[t]&&(t={varname:t,value:o[t],old:e[t]},t={dir:"from",method:"onusercontrols",nonce:p,data:t},m.postMessage(t,"*"))})}m.addEventListener("message",async function(t){if(!(t.source&&t.source!==window||t.data.nonce!=p||"to"!=t.data.dir))if(t.data.request){var e=await i(t.data.request);e&&(e={id:t.data.id,dir:"from",nonce:p,response:e},m.postMessage(e,"*"))}else{const o=n[t.data.id];o?(delete n[t.data.id],t.data.reject?o.reject(t.data.reject):o.resolve(t.data.resolve)):console.warn("promise is already fullfilled: "+t.data.id)}});const y=document.createElement("div");let v={position:"fixed",right:"0px",top:"0px",cursor:"pointer","z-index":"2147483647",width:"6px",height:"6px","line-height":"6px","font-size":"6px",color:"","padding-left":"","background-color":"",filter:"none",transition:"left 0.3s, top 0.3s, bottom 0.3s, right 0.3s"},l={width:"20px",height:"20px","line-height":"20px","font-size":"20px",color:"gray","padding-left":"8px","background-color":"#f1f3f4",filter:"dark"==u.theme?"invert(1)":"none"};o=(u.mode||"").split(":")[1];u.mode&&u.mode.startsWith("inline")&&o&&("left"==o?Object.assign(v,{right:void 0,left:"0px"}):"bottom"==o&&Object.assign(v,{top:void 0,bottom:"0px"})),Object.entries(v).filter(t=>void 0!==t[1]).forEach(t=>y.style.setProperty(t[0],t[1],"important"));let b=null,x=null;const w=()=>{if(x){const e=x;var t=x.offsetWidth;x=b=null,e.style.right=`-${t}px`,y.innerHTML="",setTimeout(()=>{document.body.removeChild(e),(u.mode||"").startsWith("inline-float")||(document.body.style.removeProperty("padding-right"),document.body.style.removeProperty("padding-left"),document.body.style.removeProperty("padding-bottom"),document.body.style.removeProperty("padding-top"),document.body.style.removeProperty("max-width"),document.body.style.removeProperty("max-height"),document.body.style.removeProperty("box-sizing")),e.mover&&document.body.removeChild(e.mover),Object.entries(v).forEach(t=>y.style.setProperty(t[0],t[1],"important"))},300)}else if(b){const o=b;b=null,o.close()}},S=()=>{b.addEventListener("data",e=>{var{type:e,text:o,caption:r}=e.data;let s=JSON.parse(localStorage.rtchelp);!0===s&&(s={});var t="usercontrols"==e&&h(s),n=(o?s[e]=o:void 0!==s[e]&&delete s[e],"usercontrols"==e&&h(s));if(Object.keys(s).length||(s=!0),localStorage.rtchelp=JSON.stringify(s),"usercontrols"==e&&g(t,n),s&&!0!==s&&c.forEach(t=>{s[t]&&(t={dir:"from",method:"setprocess",nonce:p,type:t,body:s[t]},m.postMessage(t,"*"))}),r){let t=JSON.parse(localStorage["rtchelp:functions"]||"{}");t[e]||(t[e]={}),o?t[e][r]=o:delete t[e][r],Object.keys(t[e]).length||delete t[e],(t=Object.keys(t).length?t:void 0)?localStorage["rtchelp:functions"]=JSON.stringify(t):delete localStorage["rtchelp:functions"],b.setFunction({type:e,caption:r,text:o},"Saved")}}),b.addEventListener("trigger",t=>{var{varname:t,value:e}=t.data;const o={};o[t]=e,g({},o)}),b.addEventListener("tabchange",t=>{localStorage["rtchelp:tab"]&&(localStorage["rtchelp:tab"]=t.selected)}),b.addEventListener("statsopen",t=>{var e={dir:"from",method:"statsopen",nonce:p};m.postMessage(e,"*")}),b.addEventListener("request",t=>{const{name:e,args:o}=t.data;((t,e)=>{const o=s(),r={function:t,args:e};return m.postMessage({nonce:p,dir:"from",id:o,request:r}),new Promise((t,e)=>{n[o]={request:r,resolve:t,reject:e}})})(e,o).then(t=>{b&&b.onResponse&&b.onResponse(e,t)}).catch(t=>{console.log("error in request",t)})}),setTimeout(function(){if(b){var t=localStorage.rtchelp,t=(t&&"true"!=t?b.setData(JSON.parse(t)):b.clearData(),localStorage["rtchelp:settings"]);const e=t&&JSON.parse(t);u.fontsize&&(e.fontsize=u.fontsize),b.setSettings(e,f);t=localStorage["rtchelp:functions"];t&&b.addFunctions(JSON.parse(t),"Saved")}},100),b.addEventListener("unload",()=>{b=x=null});const t=()=>{window.removeEventListener("beforeunload",t),w()};window.addEventListener("beforeunload",t),b.addEventListener("settings",t=>{var t=t.data,e=u.mode,o=u.theme,r=u.strict,s=u.savestats,n=u.fontsize,i=t.mode,a=t.theme,l=t.strict,c=t.savestats,d=t.fontsize;Object.keys(t).length?localStorage["rtchelp:settings"]=JSON.stringify(t):delete localStorage["rtchelp:settings"],void 0===f.mode&&i&&e!=i&&(u.mode=i,setTimeout(()=>{y.click();var t=(u.mode||"").split(":")[1];u.mode&&u.mode.startsWith("inline")&&("left"==t?Object.assign(v,{left:"0px",top:"0px",right:void 0,bottom:void 0}):"bottom"==t?Object.assign(v,{left:void 0,top:void 0,right:"0px",bottom:"0px"}):Object.assign(v,{left:void 0,top:"0px",right:"0px",bottom:void 0})),Object.entries(v).filter(t=>void 0===t[1]).forEach(t=>y.style.removeProperty(t[0])),Object.entries(v).filter(t=>void 0!==t[1]).forEach(t=>y.style.setProperty(t[0],t[1],"important")),setTimeout(()=>{y.click()},500)},500)),void 0===f.theme&&a!=o&&(u.theme=a||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),x&&(t="dark"==u.theme?"invert(1)":"none",x.style.setProperty("filter",t,"important"),y.style.setProperty("filter",t,"important"))),void 0===f.fontsize&&n!=d&&(u.fontsize=d||"small",x&&x.contentDocument&&x.contentDocument.body&&x.contentDocument.body.setAttribute("fontsize",u.fontsize)),void 0===f.strict&&l!=r&&(u.strict=l,e={dir:"from",method:"setstrict",nonce:p,value:u.strict},m.postMessage(e,"*")),void 0===f.savestats&&c!=s&&(u.savestats=c,i={dir:"from",method:"setsavestats",nonce:p,value:u.savestats},m.postMessage(i,"*"))});let o=localStorage["rtchelp:settings"];o&&setTimeout(async()=>{o=JSON.parse(o),u.urls=o.urls;const t=(void 0!==f.urls?f:u).urls;if(t){const e=t.split("\n").map(t=>t.trim()).filter(t=>!!t),s={};await Promise.all(e.map(async e=>{try{let n=await fetch(e,{cache:"no-cache"});if((n=await n.text()).startsWith("{")&&n.endsWith("}"))n=JSON.parse(n);else{let t=n,r=(n={},"idle"),s=[];t.split("\n").forEach((t,e)=>{var o;t=t.trimEnd(),"idle"==r&&t.match(/^\/\/@tab\s/)?(o=t.match(/\/\/@tab\s+(\w+)\s*:\s*(.*)$/))&&(r="title",o={name:o[1],title:o[2],lines:[]},s.push(o)):"title"==r&&t.match(/^(async\s+)?function\b/)?(r="function",s[s.length-1].lines.push(t)):"function"==r&&t.match(/^\};?$/)?(r="idle",s[s.length-1].lines.push(t)):"function"==r?s[s.length-1].lines.push(t):t&&console.log(`ignored line[${e}]: `+t)}),0<s.length&&"idle"!=r&&(s.pop(),r="idle"),s.length?s.forEach(t=>{var e=name2tab(t.name);let o=n[e];(o=n[e]?o:n[e]={})[t.title]&&console.log(`overwriting tab ${e}: `+t.title);e=t.lines.join("\n");o[t.title]=e}):console.warn("ignored external file due to error or incomplete",e)}for(var t in n){for(var o in n[t]){const r=n[t][o];r.match(/^(async\s+)?function\s*(\w+\s*)?\(([^\)]*)\)\s*\{([\s\S]*)\}\s*$/)||(console.warn("ignored: invalid function:",t,o),delete n[t][o])}s[t]?Object.assign(s[t],n[t]):s[t]=n[t]}}catch(t){console.error("failed to fetch or parse from "+e,t)}})),b&&Object.keys(s).length&&b.addFunctions(s,"External")}})};let O=parseInt(localStorage["rtchelp:size"]||510),P=O;const a=document.currentScript.src,j=a.substring(0,a.lastIndexOf("/")+1)+"../options/options.html";y.onclick=t=>{if(b)delete localStorage["rtchelp:tab"],w();else if(u.mode&&u.mode.startsWith("inline")){t&&(localStorage["rtchelp:tab"]="default");const i=x=document.createElement("iframe");var e={position:"fixed","z-index":"2147483647",right:`-${O}px`,top:"0px",bottom:"0px",height:"100%",width:O+"px","box-sizing":"border-box",border:"none","border-left":"1px solid lightgrey","background-color":"white",transition:"right 0.3s"};const a=u.mode.split(":")[1],o=("left"==a?Object.assign(e,{right:void 0,left:`-${O}px`,"border-left":void 0,"border-right":"1px solid lightgrey",transition:"left 0.3s"}):"bottom"==a&&Object.assign(e,{right:void 0,bottom:`-${P}px`,top:void 0,left:"0px",right:"0px",height:P+"px",width:"100%","border-left":void 0,"border-top":"1px solid lightgrey",transition:"bottom 0.3s"}),Object.entries(e).filter(t=>void 0!==t[1]).forEach(t=>i.style.setProperty(t[0],t[1],"important")),"dark"==u.theme&&i.style.setProperty("filter","invert(1)","important"),t||i.style.setProperty(a||"right","0px","important"),u.mode.startsWith("inline-float")||("left"==a?(document.body.style.setProperty("padding-left",O+"px","important"),document.body.style.setProperty("max-width",`calc(100% - ${O}px)`,"important")):"bottom"==a?(document.body.style.setProperty("padding-bottom",P+"px","important"),document.body.style.setProperty("max-height",`calc(100% - ${P}px)`,"important")):(document.body.style.setProperty("padding-right",O+"px","important"),document.body.style.setProperty("max-width",`calc(100% - ${O}px)`,"important")),document.body.style.setProperty("box-sizing","content-box","important")),i.src=j,i.onload=()=>{(b=i.contentWindow).document.body.setAttribute("noext",""),u.fontsize&&"small"!==u.fontsize&&b.document.body.setAttribute("fontsize",u.fontsize),S()},document.body.insertBefore(i,y),"left"==a?y.style.setProperty("left",O-30+"px","important"):"bottom"==a&&y.style.setProperty("bottom",P-20+"px","important"),i.mover=document.createElement("div"));e={position:"fixed","z-index":"2147483647",right:O+"px",top:"0px",bottom:"0px",width:"1px",cursor:"col-resize","box-shadow":"white 0px 1px 1px 0px"};"left"==a?Object.assign(e,{right:void 0,left:O+"px"}):"bottom"==a&&Object.assign(e,{right:void 0,bottom:P+"px",top:void 0,left:"0px",right:"0px",width:void 0,height:"1px",cursor:"row-resize"}),Object.entries(e).filter(t=>void 0!==t[1]).forEach(t=>o.style.setProperty(t[0],t[1],"important")),document.body.insertBefore(o,y),o.onmousedown=t=>{t.stopImmediatePropagation(),t.preventDefault();const o=t.currentTarget,r=(o.style.setProperty("background-color","black","important"),"bottom"==a?t.clientY:t.clientX);"bottom"==a?o.offsetTop:o.offsetLeft;const s="bottom"==a?i.offsetHeight:i.offsetWidth,n=(document.body.style.setProperty("cursor","bottom"==a?"row-resize":"col-resize","important"),i.style.setProperty("pointer-events","none","important"),t=>{var e="bottom"==a?t.clientY:t.clientX,e="left"==a?Math.max(240,e):Math.max(240,s-e+r);o.style.setProperty(a||"right",e+"px","important"),"mouseup"==t.type&&(i.style.setProperty("bottom"==a?"height":"width",e+"px","important"),document.body.style.removeProperty("cursor"),o.style.removeProperty("background-color"),i.style.removeProperty("pointer-events"),u.mode.startsWith("inline-float")||("left"==a?(document.body.style.setProperty("padding-left",i.offsetWidth+"px","important"),document.body.style.setProperty("max-width",`calc(100% - ${i.offsetWidth}px)`,"important")):"bottom"==a?(document.body.style.setProperty("padding-bottom",i.offsetHeight+"px","important"),document.body.style.setProperty("max-height",`calc(100% - ${i.offsetHeight}px)`,"important")):(document.body.style.setProperty("padding-right",i.offsetWidth+"px","important"),document.body.style.setProperty("max-width",`calc(100% - ${i.offsetWidth}px)`,"important")),document.body.style.setProperty("box-sizing","content-box","important")),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",n),localStorage["rtchelp:size"]=e,"bottom"==a?(P=e,y.style.setProperty("bottom",P-20+"px","important")):"left"==a?(O=e,y.style.setProperty("left",O-30+"px","important")):O=e)});return document.addEventListener("mousemove",n),document.addEventListener("mouseup",n),!1},y.innerHTML="&times;",t&&setTimeout(()=>{i.style.setProperty(a||"right","0px","important")},0),Object.entries(l).forEach(t=>y.style.setProperty(t[0],t[1],"important"))}else{e="rtchelp-"+window.origin.replace(/[:\\]+/g,"-");const r=b=window.open(j,e);r.addEventListener("load",()=>{r.document.body.setAttribute("noext",""),u.fontsize&&"small"!==u.fontsize&&r.document.body.setAttribute("fontsize",u.fontsize),S()})}},y.title="Click to open or close the RTC Helper options for this website",window.addEventListener("load",()=>{if(document.body.appendChild(y),localStorage["rtchelp:tab"]&&!x){y.onclick();const r=localStorage["rtchelp:tab"];let e=5,o=setInterval(()=>{if(x&&x.contentDocument){const t=x.contentDocument.querySelector("default"==r?"div.nav > div[tab]":`div.nav > div[tab="${r}"]`);t&&t.onclick&&(clearInterval(o),t.click())}--e<=0&&(clearInterval(o),console.warn("failed to open tab after some retries",r))},100)}}),document.addEventListener("keydown",function(t){const e=window.navigator?.userAgentData?.platform||window.navigator?.platform||"";(e.match(/mac/i)?t.metaKey:t.ctrlKey)&&t.shiftKey&&(t.key&&"j"===t.key||t.keyCode&&74===t.keyCode)&&(t.preventDefault(),y.onclick(),localStorage["rtchelp:tab"]||(localStorage["rtchelp:tab"]="default"))},!1);t="/res";if(document.currentScript){const M=new URL(document.currentScript.src).pathname.split("/");t=M.slice(0,M.length-2).join("/")+"/res"}const E=window._rtchelper_content;E(new BroadcastChannel(p),p,t,!1)})();
