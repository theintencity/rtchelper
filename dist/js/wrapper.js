(window._rtchelper||document.querySelector("html").hasAttribute("rtchelper")?function(){}:function(){var t={};const i=["videocapture","screencapture","devicelist","mediastream","usermedia","mediacodec","mediaconnect","medianetwork","datachannel","websocket","webrequest"],e=["Capture","Screen","Devices","Media","Session","Connect","Network","Data","Socket","Request"];if(name2tab=t=>{console.assert(i.length===e.length);t=e.indexOf(t);return 0<=t?i[t]:""},document.currentScript){const S=document.currentScript.getAttribute("src");var o=S.indexOf("?");if(0<=o){const O=S.substring(o);Object.assign(t,Object.fromEntries(O.substring(1).split("&").filter(t=>!!t).map(t=>{var e=t.indexOf("=");return 0<=e?[decodeURIComponent(t.substring(0,e)),decodeURIComponent(t.substring(e+1))]:[t,null]})))}}const n=t=>(""+Math.random()).substring(2,t||8),c=n(20),l=new BroadcastChannel(c),s={},p={},m={};var r,o=t=>Object.fromEntries(t.split("|").map(t=>t.trim()).filter(t=>t).map(t=>{var e=t.indexOf(":");return e<0?[t,void 0]:[t.substring(0,e),t.substring(e+1)]}));t.settings&&(r=o(t.settings),Object.assign(m,r)),t.required&&(r=o(t.required),Object.assign(p,r),Object.assign(m,r));{const z=JSON.parse(localStorage["rtchelp:settings"]||"{}");["mode","theme","fontsize","strict"].forEach(t=>{void 0!==z[t]&&void 0===p[t]&&(m[t]=z[t])}),m.theme||(m.theme=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),m.fontsize||(m.fontsize="small"),m.strict&&setTimeout(()=>{var t={dir:"from",method:"setstrict",nonce:c,value:m.strict};l.postMessage(t,"*")})}l.addEventListener("message",async function(t){var n;if(!(t.source&&t.source!==window||t.data.nonce!=c||"to"!=t.data.dir))if(t.data.request){n=t.data.request;var e=await new Promise((t,e)=>{if(0<=i.indexOf(n.function)){var o=localStorage.rtchelp;if("object"==typeof(o=void 0===o?localStorage.rtchelp=!0:JSON.parse(o)))for(var r in o)r!==n.function&&delete o[r];m.strict?setTimeout(()=>{t({resolve:o})}):t({resolve:o})}else t()});e&&(e={id:t.data.id,dir:"from",nonce:c,response:e},l.postMessage(e,"*"))}else{const o=s[t.data.id];o?(delete s[t.data.id],t.data.reject?o.reject(t.data.reject):o.resolve(t.data.resolve)):console.warn("promise is already fullfilled: "+t.data.id)}});const f=document.createElement("div");let h={position:"fixed",right:"0px",top:"0px",cursor:"pointer","z-index":"2147483647",width:"6px",height:"6px","line-height":"6px","font-size":"6px",color:"","padding-left":"","background-color":"",filter:"none",transition:"left 0.3s, top 0.3s, bottom 0.3s, right 0.3s"},d={width:"20px",height:"20px","line-height":"20px","font-size":"20px",color:"gray","padding-left":"8px","background-color":"#f1f3f4",filter:"dark"==m.theme?"invert(1)":"none"};o=(m.mode||"").split(":")[1];m.mode&&m.mode.startsWith("inline")&&o&&("left"==o?Object.assign(h,{right:void 0,left:"0px"}):"bottom"==o&&Object.assign(h,{top:void 0,bottom:"0px"})),Object.entries(h).filter(t=>void 0!==t[1]).forEach(t=>f.style.setProperty(t[0],t[1],"important"));let u=null,y=null;const g=()=>{if(y){const e=y;var t=y.offsetWidth;y=u=null,e.style.right=`-${t}px`,f.innerHTML="",setTimeout(()=>{document.body.removeChild(e),(m.mode||"").startsWith("inline-float")||(document.body.style.removeProperty("padding-right"),document.body.style.removeProperty("padding-left"),document.body.style.removeProperty("padding-bottom"),document.body.style.removeProperty("padding-top"),document.body.style.removeProperty("max-width"),document.body.style.removeProperty("max-height"),document.body.style.removeProperty("box-sizing")),e.mover&&document.body.removeChild(e.mover),Object.entries(h).forEach(t=>f.style.setProperty(t[0],t[1],"important"))},300)}else if(u){const o=u;u=null,o.close()}},b=()=>{u.addEventListener("data",e=>{var{type:e,text:o,caption:r}=e.data;let n=JSON.parse(localStorage.rtchelp);if(!0===n&&(n={}),o?n[e]=o:void 0!==n[e]&&delete n[e],Object.keys(n).length||(n=!0),localStorage.rtchelp=JSON.stringify(n),n&&!0!==n&&i.forEach(t=>{n[t]&&(t={dir:"from",method:"setprocess",nonce:c,type:t,body:n[t]},l.postMessage(t,"*"))}),r){let t=JSON.parse(localStorage["rtchelp:functions"]||"{}");t[e]||(t[e]={}),o?t[e][r]=o:delete t[e][r],Object.keys(t[e]).length||delete t[e],(t=Object.keys(t).length?t:void 0)?localStorage["rtchelp:functions"]=JSON.stringify(t):delete localStorage["rtchelp:functions"],u.setFunction({type:e,caption:r,text:o},"Saved")}}),u.addEventListener("tabchange",t=>{localStorage["rtchelp:tab"]&&(localStorage["rtchelp:tab"]=t.selected)}),u.addEventListener("request",t=>{const{name:e,args:o}=t.data;((t,e)=>{const o=n(),r={function:t,args:e};return l.postMessage({nonce:c,dir:"from",id:o,request:r}),new Promise((t,e)=>{s[o]={request:r,resolve:t,reject:e}})})(e,o).then(t=>{u&&u.onResponse&&u.onResponse(e,t)}).catch(t=>{console.log("error in request",t)})}),setTimeout(function(){if(u){var t=localStorage.rtchelp,t=(t&&"true"!=t?u.setData(JSON.parse(t)):u.clearData(),localStorage["rtchelp:settings"]);const e=t&&JSON.parse(t);m.fontsize&&(e.fontsize=m.fontsize),u.setSettings(e,p);t=localStorage["rtchelp:functions"];t&&u.addFunctions(JSON.parse(t),"Saved")}},100),u.addEventListener("unload",()=>{u=y=null});const t=()=>{window.removeEventListener("beforeunload",t),g()};window.addEventListener("beforeunload",t),u.addEventListener("settings",t=>{var t=t.data,e=m.mode,o=m.theme,r=m.strict,n=m.fontsize,i=t.mode,s=t.theme,a=t.strict,d=t.fontsize;Object.keys(t).length?localStorage["rtchelp:settings"]=JSON.stringify(t):delete localStorage["rtchelp:settings"],void 0===p.mode&&i&&e!=i&&(m.mode=i,setTimeout(()=>{f.click();var t=(m.mode||"").split(":")[1];m.mode&&m.mode.startsWith("inline")&&("left"==t?Object.assign(h,{left:"0px",top:"0px",right:void 0,bottom:void 0}):"bottom"==t?Object.assign(h,{left:void 0,top:void 0,right:"0px",bottom:"0px"}):Object.assign(h,{left:void 0,top:"0px",right:"0px",bottom:void 0})),Object.entries(h).filter(t=>void 0===t[1]).forEach(t=>f.style.removeProperty(t[0])),Object.entries(h).filter(t=>void 0!==t[1]).forEach(t=>f.style.setProperty(t[0],t[1],"important")),setTimeout(()=>{f.click()},500)},500)),void 0===p.theme&&s!=o&&(m.theme=s||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),y&&(t="dark"==m.theme?"invert(1)":"none",y.style.setProperty("filter",t,"important"),f.style.setProperty("filter",t,"important"))),void 0===p.fontsize&&n!=d&&(m.fontsize=d||"small",y&&y.contentDocument&&y.contentDocument.body&&y.contentDocument.body.setAttribute("fontsize",m.fontsize)),void 0===p.strict&&a!=r&&(m.strict=a,e={dir:"from",method:"setstrict",nonce:c,value:m.strict},l.postMessage(e,"*"))})};let v=parseInt(localStorage["rtchelp:size"]||510),x=v;const a=document.currentScript.src,w=a.substring(0,a.lastIndexOf("/")+1)+"../options/options.html";f.onclick=t=>{if(u)delete localStorage["rtchelp:tab"],g();else if(m.mode&&m.mode.startsWith("inline")){t&&(localStorage["rtchelp:tab"]="default");const s=y=document.createElement("iframe");var e={position:"fixed","z-index":"2147483647",right:`-${v}px`,top:"0px",bottom:"0px",height:"100%",width:v+"px","box-sizing":"border-box",border:"none","border-left":"1px solid lightgrey","background-color":"white",transition:"right 0.3s"};const a=m.mode.split(":")[1],o=("left"==a?Object.assign(e,{right:void 0,left:`-${v}px`,"border-left":void 0,"border-right":"1px solid lightgrey",transition:"left 0.3s"}):"bottom"==a&&Object.assign(e,{right:void 0,bottom:`-${x}px`,top:void 0,left:"0px",right:"0px",height:x+"px",width:"100%","border-left":void 0,"border-top":"1px solid lightgrey",transition:"bottom 0.3s"}),Object.entries(e).filter(t=>void 0!==t[1]).forEach(t=>s.style.setProperty(t[0],t[1],"important")),"dark"==m.theme&&s.style.setProperty("filter","invert(1)","important"),t||s.style.setProperty(a||"right","0px","important"),m.mode.startsWith("inline-float")||("left"==a?(document.body.style.setProperty("padding-left",v+"px","important"),document.body.style.setProperty("max-width",`calc(100% - ${v}px)`,"important")):"bottom"==a?(document.body.style.setProperty("padding-bottom",x+"px","important"),document.body.style.setProperty("max-height",`calc(100% - ${x}px)`,"important")):(document.body.style.setProperty("padding-right",v+"px","important"),document.body.style.setProperty("max-width",`calc(100% - ${v}px)`,"important")),document.body.style.setProperty("box-sizing","content-box","important")),s.src=w,s.onload=()=>{(u=s.contentWindow).document.body.setAttribute("noext",""),m.fontsize&&"small"!==m.fontsize&&u.document.body.setAttribute("fontsize",m.fontsize),b()},document.body.insertBefore(s,f),"left"==a?f.style.setProperty("left",v-30+"px","important"):"bottom"==a&&f.style.setProperty("bottom",x-20+"px","important"),s.mover=document.createElement("div"));e={position:"fixed","z-index":"2147483647",right:v+"px",top:"0px",bottom:"0px",width:"1px",cursor:"col-resize","box-shadow":"white 0px 1px 1px 0px"};"left"==a?Object.assign(e,{right:void 0,left:v+"px"}):"bottom"==a&&Object.assign(e,{right:void 0,bottom:x+"px",top:void 0,left:"0px",right:"0px",width:void 0,height:"1px",cursor:"row-resize"}),Object.entries(e).filter(t=>void 0!==t[1]).forEach(t=>o.style.setProperty(t[0],t[1],"important")),document.body.insertBefore(o,f),o.onmousedown=t=>{t.stopImmediatePropagation(),t.preventDefault();const o=t.currentTarget,r=(o.style.setProperty("background-color","black","important"),"bottom"==a?t.clientY:t.clientX);"bottom"==a?o.offsetTop:o.offsetLeft;const n="bottom"==a?s.offsetHeight:s.offsetWidth,i=(document.body.style.setProperty("cursor","bottom"==a?"row-resize":"col-resize","important"),s.style.setProperty("pointer-events","none","important"),t=>{var e="bottom"==a?t.clientY:t.clientX,e="left"==a?Math.max(240,e):Math.max(240,n-e+r);o.style.setProperty(a||"right",e+"px","important"),"mouseup"==t.type&&(s.style.setProperty("bottom"==a?"height":"width",e+"px","important"),document.body.style.removeProperty("cursor"),o.style.removeProperty("background-color"),s.style.removeProperty("pointer-events"),m.mode.startsWith("inline-float")||("left"==a?(document.body.style.setProperty("padding-left",s.offsetWidth+"px","important"),document.body.style.setProperty("max-width",`calc(100% - ${s.offsetWidth}px)`,"important")):"bottom"==a?(document.body.style.setProperty("padding-bottom",s.offsetHeight+"px","important"),document.body.style.setProperty("max-height",`calc(100% - ${s.offsetHeight}px)`,"important")):(document.body.style.setProperty("padding-right",s.offsetWidth+"px","important"),document.body.style.setProperty("max-width",`calc(100% - ${s.offsetWidth}px)`,"important")),document.body.style.setProperty("box-sizing","content-box","important")),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",i),localStorage["rtchelp:size"]=e,"bottom"==a?(x=e,f.style.setProperty("bottom",x-20+"px","important")):"left"==a?(v=e,f.style.setProperty("left",v-30+"px","important")):v=e)});return document.addEventListener("mousemove",i),document.addEventListener("mouseup",i),!1},f.innerHTML="&times;",t&&setTimeout(()=>{s.style.setProperty(a||"right","0px","important")},0),Object.entries(d).forEach(t=>f.style.setProperty(t[0],t[1],"important"))}else{e="rtchelp-"+window.origin.replace(/[:\\]+/g,"-");const r=u=window.open(w,e);r.addEventListener("load",()=>{r.document.body.setAttribute("noext",""),m.fontsize&&"small"!==m.fontsize&&r.document.body.setAttribute("fontsize",m.fontsize),b()})}},f.title="Click to open or close the RTC Helper options for this website",window.addEventListener("load",()=>{if(document.body.appendChild(f),localStorage["rtchelp:tab"]&&!y){f.onclick();const r=localStorage["rtchelp:tab"];let e=5,o=setInterval(()=>{if(y&&y.contentDocument){const t=y.contentDocument.querySelector("default"==r?"div.nav > div[tab]":`div.nav > div[tab="${r}"]`);t&&t.onclick&&(clearInterval(o),t.click())}--e<=0&&(clearInterval(o),console.warn("failed to open tab after some retries",r))},100)}}),document.addEventListener("keydown",function(t){const e=window.navigator?.userAgentData?.platform||window.navigator?.platform||"";(e.match(/mac/i)?t.metaKey:t.ctrlKey)&&t.shiftKey&&(t.key&&"j"===t.key||t.keyCode&&74===t.keyCode)&&(t.preventDefault(),f.onclick(),localStorage["rtchelp:tab"]||(localStorage["rtchelp:tab"]="default"))},!1);t="/res";if(document.currentScript){const k=new URL(document.currentScript.src).pathname.split("/");t=k.slice(0,k.length-2).join("/")+"/res"}const P=window._rtchelper_content;P(new BroadcastChannel(c),c,t,!1)})();
