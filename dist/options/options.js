!function(){"undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.id&&ace.config.set("loadWorkerFromBlob",!1),window.addEventListener("load",()=>{{let b="chrome-extension:"==window.location.protocol;b&&document.body.setAttribute("extension","");const i=l("div.content > div.tab[tab]").map(e=>{var t=e.getAttribute("hide"),i=e.getAttribute("name"),n=e.hasAttribute("noasync");return{hide:t,tab:e.getAttribute("tab"),name:i,title:(m("div.help > div.title",e)||{}).innerText,static:!!e.className.match(/\bstatic\b/),div:e,noasync:n}}),n=[].concat(i,o),a=(o.splice(0,o.length,...n),o.filter(e=>!e.static).forEach(e=>{const t=m("template#tab-item"),i=t.content.cloneNode(!0),n=i.querySelector("div:nth-child(1)"),a=i.querySelector("div:nth-child(2)");var o=i.querySelector(`div[tab="${e.tab}"]`),d=e.hide&&(b&&"extension"==e.hide||!b&&"extension"!=e.hide),r=(n.setAttribute("tab",e.tab),n.setAttribute("title",(e.title||"").replace(/\n/,"<line>\n").replace(/\n\s*/g," ").replace(/<line>\s/,"\n\n")),n.innerText=e.name,d||m("div.nav").insertBefore(n,m("div.nav > div.last")),a.setAttribute("tab",e.tab),!!e.div);if(r?(a.replaceChild(e.div.querySelector("div.help"),a.querySelector("div.help")),e.noasync&&a.setAttribute("noasync","")):(m("div.title",a).innerText=e.title,m("div.desc",a).innerText=e.desc),m("div.title",a).onclick=e=>{const t=e.currentTarget.parentNode;t.hasAttribute("expanded")?t.removeAttribute("expanded"):t.setAttribute("expanded",""),setTimeout(()=>{const e=t.parentNode.editor;e&&e.resize()},500)},o&&[].slice.call(o.children).forEach(e=>{a.appendChild(e)}),r?m("div.content").replaceChild(a,e.div):m("div.content").insertBefore(a,m("div.content > div.tab.last")),!d){const c=m('div.tab[tab="help"] ol.topics'),s=document.createElement("li"),l=(s.innerText=e.title,s.setAttribute("tab",e.tab),c.appendChild(s),s.onclick=e=>{var e=e.currentTarget.getAttribute("tab");const t=m(`div.nav > div[tab="${e}"]:not([hidden])`);t&&(t.click(),e=m(`div.tab[tab="${e}"]`),m("div.help",e).hasAttribute("expanded")||m("div.help > div.title",e).click())},m('div.tab[tab="help"] table.topicdesc tbody')),u=document.createElement("tr"),v=document.createElement("td"),p=(v.innerText=e.name,u.appendChild(v),document.createElement("td")),h=(m("div.desc",a).innerText||"").split(".")[0];p.innerText=e.title+". "+h.trim(),u.appendChild(p),l.appendChild(u)}}),m("div.nav").onscroll=e=>{var t=m("div.nav"),i=0<t.scrollLeft,t=t.scrollLeft+t.offsetWidth<t.scrollWidth;m("div.nav").setAttribute("scroll",i&&t?"both":i?"left":t?"right":"")});m("div.nav").style.setProperty("scroll-behavior","auto"),a(),setTimeout(()=>{m("div.nav").style.setProperty("scroll-behavior","")},500),m("div.nav > div.before").onclick=e=>{const t=m("div.nav");t.scrollLeft=Math.max(0,t.scrollLeft-Math.min(t.offsetWidth,200)),a()},m("div.nav > div.after").onclick=e=>{const t=m("div.nav");t.scrollLeft=Math.min(t.scrollWidth,t.scrollLeft+Math.min(t.offsetWidth,200)),a()},l("div.nav > div").filter(e=>e.hasAttribute("tab")).forEach(e=>{e.onclick=e=>{m("body").getAttribute("selected");e=e.currentTarget.getAttribute("tab");m("body").setAttribute("selected",e),m(`div.nav > div[tab="${e}"]`).scrollIntoView({inline:"center"});const t=m(`div.tab[tab="${e}"]`);t&&t.editor&&t.editor.resize(),dispatchEvent(Object.assign(new Event("tabchange"),{selected:m("body").getAttribute("selected")}))}}),l("div.content > div.tab").forEach((n,e)=>{const a=n.getAttribute("tab"),t=m("div.editor",n);if(t){t.id||(t.id="editor-"+e);const o=n.editor=ace.edit(t.id);o.setTheme("ace/theme/clouds"),o.session.setMode("ace/mode/javascript"),o.session.setUseWrapMode(!0),o.setHighlightActiveLine(!1),o.session.on("changeMode",()=>{o.session.$worker&&o.session.$worker.send("changeOptions",[{"-W025":!1,esversion:8}])},1e3);e=()=>{h(n,!0,!0),m("select",n).changing||!function(e,t){const i=m("input.caption",e),n=m("select",e),a=n.selectedOptions[0];t?k&&!e.hasAttribute("editing")&&(e.setAttribute("editing",""),!i.value&&0<n.selectedIndex&&(t=n.value,i.value=("Saved"==a.getAttribute("source")?"":"(Edit) ")+t)):e.hasAttribute("editing")&&(e.removeAttribute("editing"),i.value="");return a&&"Saved"==a.getAttribute("source")}(n,!0)&&0<m("select",n).selectedIndex&&(m("select",n).selectedIndex=0)};o.on("change",e),o.on("paste",e),m("button.save",n).onclick=e=>{const t=o.getValue();var i;(n.hasAttribute("noasync")||void 0)&&t&&t.match(/^async\s+function\b/)?(console.warn("async function is not allowed here"),o.selection.setRange(new ace.Range(0,0,0,6))):(i=n.hasAttribute("editing")&&n.querySelector("input.caption").value||void 0,i={type:a,text:t,caption:i},dispatchEvent(Object.assign(new Event("data"),{data:i})),setTimeout(()=>{h(n,!1)}))}}});{const c=m('div.tab[tab="settings"]'),s=o.map(e=>e.name).join(",");m("h2",c).onclick=e=>{c.hasAttribute("verbose")?c.removeAttribute("verbose"):c.setAttribute("verbose","")},m("select.fontsize",c).onchange=m("textarea.tabslist",c).onchange=m("textarea.tabslist",c).onkeyup=m("textarea.tabslist",c).onfocus=e=>{""===e.currentTarget.value&&(e.currentTarget.value=s)},m("textarea.tabslist",c).onblur=e=>{e.currentTarget.value==s&&(e.currentTarget.value="")},m('input.mode[value="open"]',c).onclick=m('input.mode[value="open-pinned"]',c).onclick=m('input.mode[value="open-popup"]',c).onclick=m('input.mode[value="inline"]',c).onclick=m('input.mode[value="inline-float"]',c).onclick=e=>{h(c,!0);var t=e.currentTarget.getAttribute("value");e.currentTarget.checked?("open"==t||"open-pinned"==t||"open-popup"==t?m('input.mode[value="inline"]',c).checked=m('input.mode[value="inline-float"]',c).checked=!1:"inline"!=t&&"inline-float"!=t||(m('input.mode[value="open"]',c).checked=m('input.mode[value="open-pinned"]',c).checked=!1,m('input.mode[value="open-popup"]',c).checked=!1),"open-pinned"==t?(m('input.mode[value="open"]',c).checked=!0,m('input.mode[value="open-popup"]',c).checked=!1):"open-popup"==t?(m('input.mode[value="open"]',c).checked=!0,m('input.mode[value="open-pinned"]',c).checked=!1):"inline-float"==t&&(m('input.mode[value="inline"]',c).checked=!0)):"open"==t?(m('input.mode[value="open-pinned"]',c).checked=!1,m('input.mode[value="open-popup"]',c).checked=!1):"inline"==t&&(m('input.mode[value="inline-float"]',c).checked=!1)},m('input.mode-suffix[value="left"]',c).onclick=m('input.mode-suffix[value="bottom"]',c).onclick=e=>{h(c,!0);var t=e.currentTarget.getAttribute("value");e.currentTarget.checked&&("left"==t?m('input.mode-suffix[value="bottom"]',c).checked=!1:"bottom"==t&&(m('input.mode-suffix[value="left"]',c).checked=!1))},m('input.theme[value="light"]',c).onclick=m('input.theme[value="dark"]',c).onclick=e=>{h(c,!0),e.currentTarget.checked&&("light"==e.currentTarget.getAttribute("value")?m('input.theme[value="dark"]',c).checked=!1:m('input.theme[value="light"]',c).checked=!1)},m('input.scripts[value="edit"]',c).onclick=m('input.scripts[value="named"]',c).onclick=e=>{h(c,!0),e.currentTarget.checked?"named"==e.currentTarget.getAttribute("value")&&(m('input.scripts[value="edit"]',c).checked=!0):"edit"==e.currentTarget.getAttribute("value")&&(m('input.scripts[value="named"]',c).checked=!1)},m('input.strict[value="always"]',c).onclick=m('input.strict[value="external"]',c).onclick=e=>{h(c,!0),e.currentTarget.checked&&("always"==e.currentTarget.getAttribute("value")?m('input.strict[value="external"]',c).checked=!1:m('input.strict[value="always"]',c).checked=!1)},l("input.editor",c).forEach(e=>{e.onclick=e=>{h(c,!0)}}),m("button.reset",c).onclick=e=>{h(c,!0),v({})},m("button.save",c).onclick=e=>{m("textarea.tabslist").blur();let t=m("textarea.tabslist",c).value||void 0;t===s&&(t=void 0);var i=m("select.fontsize",c).value||void 0;let n=m('input.mode[value="open-pinned"]',c).checked?"open-pinned":m('input.mode[value="open-popup"]',c).checked?"open-popup":m('input.mode[value="open"]',c).checked?"open":m('input.mode[value="inline-float"]',c).checked?"inline-float":m('input.mode[value="inline"]',c).checked?"inline":void 0;n&&n.startsWith("inline")&&((a=m('input.mode-suffix[value="left"]',c).checked?"left":m('input.mode-suffix[value="bottom"]',c).checked?"bottom":void 0)&&(n+=":"+a));var a=m('input.theme[value="light"]',c).checked?"light":m('input.theme[value="dark"]',c).checked?"dark":void 0,o=m('input.scripts[value="named"]',c).checked?"named":m('input.scripts[value="edit"]',c).checked?void 0:"noedit",d=m('input.strict[value="always"]',c).checked?"always":m('input.strict[value="external"]',c).checked?"external":void 0;let r=[];l("input.editor",c).forEach(e=>{var t=e.checked,i=e.hasAttribute("checked");t!==i&&r.push((i?"no":"")+e.getAttribute("value"))}),r=0<r.length?r.join(","):void 0;a=JSON.parse(JSON.stringify({mode:n,theme:a,fontsize:i,strict:d,scripts:o,editor:r,tabslist:t}));dispatchEvent(Object.assign(new Event("settings"),{data:a})),g(t),A(o),x(r),y(i),setTimeout(()=>{h(c,!1)})};var e=m('div.tab[tab="help"]');m("button.help",e).onclick=e=>{if("undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.getManifest){var t=chrome.runtime.getManifest().homepage_url;window.open(t,"_blank")}else{const i=window.open("about:blank","_blank");fetch("../manifest.json?r="+(""+Math.random()).substring(2,10)).then(e=>e.text()).then(e=>{e=e.replace(/\\"|"(?:\\"|[^"])*"|(\/\/.*|\/\*[\s\S]*?\*\/)/g,(e,t)=>t?"":e);try{var t=JSON.parse(e);i.location.href=t.homepage_url}catch(e){console.error("failed to parse manifest.json",e)}}).catch(e=>{console.error("failed to fetch manifest.json",e)})}}}u(functions);{var t=functions;let e=Object.entries(t).map(([t,e])=>Object.keys(e).map(e=>({type:t,question:e}))).flat();const d=Object.fromEntries(Object.keys(t).map(e=>{var t=m(`div.tab[tab="${e}"] div.help > div.title`);return[e,t&&t.innerText]})),r=m('div.tab[tab="help"] ol.features');let o=null;e.forEach(({type:e,question:t})=>{if(e!=o&&d[e]){o=e;const a=document.createElement("span");a.setAttribute("tab",e),a.data={type:e},a.innerText=d[e],r.appendChild(a)}const i=document.createElement("li");i.setAttribute("tab",e),i.data={type:e,question:t};let n=t;e=t.indexOf(" - ");n=(n=0<=e?t.substring(e+3):n).substring(0,1).toUpperCase()+n.substring(1),i.innerText=n,r.appendChild(i),i.onclick=e=>{const i=e.currentTarget,t=m(`div.nav > div[tab="${i.data.type}"]:not([hidden])`);if(t){t.click();const a=m(`div.content > div.tab[tab="${i.data.type}"]`);if(a){a.click();e=m("select",a);if(e){let t=null;var n=[].slice.call(e.children).findIndex(e=>(t=e.data,e.innerText==i.data.question));a.editor&&(f(a.editor,t,e),h(a,!0)),0<=n&&p(e,n)}}}}})}return l("div.content > div.tab").forEach((i,e)=>{m("div.editor",i)&&(m("select",i).onchange=e=>{var t;e.currentTarget.selectedOptions&&(h(i,!0),t=e.currentTarget.selectedOptions[0].data,f(i.editor,t,e.currentTarget))})}),void document.addEventListener("keydown",function(e){const t=window.navigator?.userAgentData?.platform||window.navigator?.platform||"";if((t.match(/mac/i)?e.metaKey:e.ctrlKey)&&(e.key&&"s"===e.key||e.keyCode&&83===e.keyCode)){e.preventDefault();e=m(`div.tab[tab="${document.body.getAttribute("selected")}"]`);const i=e&&m("button.save",e);i&&i.click()}},!1)}});const o=[];function m(e,t){return(t||document).querySelector(e)}function l(e,t){return[].slice.call((t||document).querySelectorAll(e))}function u(r,c){l("div.content > div.tab").forEach((e,t)=>{const n=e.getAttribute("tab");if(m("div.editor",e)){const a=m("select",e),i=Object.keys(r[n]||[]);if(c&&0<i.length){const o=document.createElement("option");o.setAttribute("source",c),o.setAttribute("role","separator"),o.innerHTML="&#x2500;".repeat(4)+" "+c+" "+"&#x2500;".repeat(4),o.setAttribute("disabled",""),a.appendChild(o)}if(i.sort().forEach(e=>{var t=r[n][e].toString();const i=document.createElement("option");i.innerText=e,i.data=t,c&&i.setAttribute("source",c),a.appendChild(i)}),0==a.selectedIndex&&e.editor){const d=e.editor.getValue()||"",t=[].slice.call(a.children).findIndex(e=>e.data==d);0<=t&&p(a,t)}}})}let a=void 0;function v(e,t){if(void 0!==t){const i=(a=t)?Object.keys(t):[];l('div.tab[tab="settings"] > div[name]').forEach(e=>{var t=e.getAttribute("name");0<=i.indexOf(t)?e.setAttribute("disabled",""):e.removeAttribute("disabled")})}if(a&&(e=e||{},Object.assign(e,a)),void 0!==e){t=m('div.tab[tab="settings"]');m("textarea.tabslist",t).value=e.tabslist||"",m("select.fontsize",t).value=e.fontsize||"small",m('input.mode[value="open"]',t).checked=e.mode&&e.mode.startsWith("open"),m('input.mode[value="open-pinned"]',t).checked="open-pinned"==e.mode,m('input.mode[value="open-popup"]',t).checked="open-popup"==e.mode,m('input.mode[value="inline"]',t).checked=e.mode&&e.mode.startsWith("inline"),m('input.mode[value="inline-float"]',t).checked=e.mode&&e.mode.startsWith("inline-float"),m('input.mode-suffix[value="left"]',t).checked=e.mode&&e.mode.startsWith("inline")&&e.mode.endsWith(":left"),m('input.mode-suffix[value="bottom"]',t).checked=e.mode&&e.mode.startsWith("inline")&&e.mode.endsWith(":bottom"),m('input.theme[value="light"]',t).checked="light"==e.theme,m('input.theme[value="dark"]',t).checked="dark"==e.theme,m('input.scripts[value="edit"]',t).checked=!e.scripts||"noedit"!=e.scripts,m('input.scripts[value="named"]',t).checked="named"==e.scripts,m('input.strict[value="always"]',t).checked="always"==e.strict,m('input.strict[value="external"]',t).checked="external"==e.strict;const n=e.editor?e.editor.split(","):[];l("input.editor",t).forEach(e=>{e.hasAttribute("checked")?e.checked=n.indexOf("no"+e.getAttribute("value"))<0:e.checked=!(n.indexOf(e.getAttribute("value"))<0)}),g(e.tabslist),A(e.scripts),x(e.editor),y(e.fontsize)}}function p(e,t){e.selectedIndex=t}function h(e,t,i){t?e.hasAttribute("dirty")||e.setAttribute("dirty",""):e.hasAttribute("dirty")&&e.removeAttribute("dirty",""),i||e.hasAttribute("editing")&&(e.removeAttribute("editing"),m("input.caption",e).value="")}let d=!0;function f(e,t,i){e&&(i.changing=!0,e.setValue(t||"",-1),d&&setTimeout(()=>{e.session.foldAllComments()}),delete i.changing)}let r=void 0;function g(e){let i=e?e.split(",").map(e=>e.trim()).filter(e=>!!e):null;i&&!i.length&&(i=void 0);var e=(r||[]).join(","),t=(i||[]).join(",");r=i;const n=[];l("div.nav > div[tab]").forEach(e=>{var t=e.innerText;i&&i.indexOf(t)<0?"Settings"!=t?e.hasAttribute("hidden")||e.setAttribute("hidden",""):e.hasAttribute("hidden")&&e.removeAttribute("hidden"):(i&&n.push(e.getAttribute("tab")),e.hasAttribute("hidden")&&e.removeAttribute("hidden"))}),e!=t&&(i?(l("div.nav > div[tab]").forEach(e=>{e.innerText;var t=i.indexOf(e.innerText);e.style.setProperty("order",""+(t<0?98:t))}),m("div.nav > div.before").style.setProperty("order","-1"),m("div.nav > div.after").style.setProperty("order","99")):l("div.nav > div[tab], div.nav > div.before, div.nav > div.after").forEach(e=>{e.style.removeProperty("order")}),i?l('div.tab[tab="help"] ol.topics > li[tab], div.tab[tab="help"] ol.features > li[tab], div.tab[tab="help"] ol.features > span[tab]').forEach(e=>{var t=e.getAttribute("tab");n.indexOf(t)<0?e.setAttribute("hidden",""):e.removeAttribute("hidden")}):l('div.tab[tab="help"] ol.topics > li[tab], div.tab[tab="help"] ol.features > li[tab], div.tab[tab="help"] ol.features > span[tab]').forEach(e=>{e.removeAttribute("hidden")}))}let k=void 0;function A(t){const i=k;i!==t&&(k=t,l("div.content > div.tab[tab]:not(.static)").forEach(e=>{e.editor&&e.editor.setReadOnly("noedit"==t)}),"named"!=i&&"named"!=t||l("div.content > div.tab[tab]:not(.static)").forEach(e=>{e.editor&&("named"==i?e.removeAttribute("editing"):e.hasAttribute("dirty")&&0==e.querySelector("select").selectedIndex&&e.setAttribute("editing",""))}))}function x(e){const n=[],a=[],t=(l("div.content > div.tab[tab]:not(.static)").forEach(e=>{e.editor&&(n.push(e.editor),a.push(e))}),l('div.tab[tab="settings"] input.editor').map(e=>{return{value:e.getAttribute("value"),def:e.hasAttribute("checked")}})),o=e?e.split(","):[];t.forEach(({value:e,def:t})=>{const i=t?o.indexOf("no"+e)<0:!(o.indexOf(e)<0);switch(e){case"wrap":n.forEach(e=>e.session.setUseWrapMode(i));break;case"highlightline":n.forEach(e=>e.setHighlightActiveLine(i));break;case"highlightword":n.forEach(e=>e.setHighlightSelectedWord(i));break;case"invisibles":n.forEach(e=>e.setShowInvisibles(i));break;case"indentguide":n.forEach(e=>e.setDisplayIndentGuides(i));break;case"foldcomment":d=i,a.forEach(e=>{const t=e.editor;var i=m("select",e),n=e.hasAttribute("dirty");f(t,t.getValue()||"",i),h(e,n,!0)});break;default:console.warn("unsupported attribute",e)}})}function y(e){e&&"small"!=e?document.body.setAttribute("fontsize",e):document.body.hasAttribute("fontsize")&&document.body.removeAttribute("fontsize")}window.setData=function(n){l("div.content > div.tab:not(.static)").forEach(e=>{const t=e.getAttribute("tab");var i=m("select",e);i&&(p(i,0),f(e.editor,n[t],i),h(e,!1),0<=(e=[].slice.call(i.children).findIndex(e=>e.data==n[t]))&&p(i,e))})},window.clearData=function(){l("div.content > div.tab").forEach(e=>{e.getAttribute("tab");var t=m("select",e);t&&(h(e,!1),p(t,0),f(e.editor,"",t))})},window.onResponse=function(e,t){console.log("response",e,t)},window.addFunctions=u,window.setFunction=function(i,n){const{type:e,text:a,caption:o}=i,d=m(`div.tab[tab="${e}"]`),r=m("select",d);if(m("div.editor",d)&&r){const c=l(`option[source="${n}"]:not([role])`,r);var i=c.findIndex(e=>e.innerText==o);let t=0<=i?c[i]:null;if(a){let e=m(`option[role="separator"][source="${n}"]`,r);if(e||((e=document.createElement("option")).setAttribute("source",n),e.setAttribute("role","separator"),e.innerHTML="&#x2500;".repeat(4)+" "+n+" "+"&#x2500;".repeat(4),e.setAttribute("disabled",""),r.appendChild(e)),t?t.data!==a&&(t.data=a):((t=document.createElement("option")).innerText=o,t.data=a,t.setAttribute("source",n),r.insertBefore(t,e.nextElementSibling)),0==r.selectedIndex&&d.editor){const a=d.editor.getValue()||"";var i=[].slice.call(r.children).findIndex(e=>e.data==a);0<=i&&p(r,i)}}else t&&(i=r.selectedOptions[0]===t,r.removeChild(t),i&&(r.selectedIndex=0),l(`option[source="${n}"]:not([role])`,r).length||(i=m(`option[role="separator"][source="${n}"]`,r))&&r.removeChild(i))}},window.setSettings=v,window.setTab=function(e){const t=m("default"==e?"div.nav > div[tab]":`div.nav > div[tab="${e}"]`);t&&t.click()}}();
